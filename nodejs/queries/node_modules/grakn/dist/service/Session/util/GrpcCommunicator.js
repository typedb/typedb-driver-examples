"use strict";function _asyncToGenerator(a){return function(){var b=a.apply(this,arguments);return new Promise(function(a,c){function d(e,f){try{var g=b[e](f),h=g.value}catch(a){return void c(a)}return g.done?void a(h):Promise.resolve(h).then(function(a){d("next",a)},function(a){d("throw",a)})}return d("next")})}}function GrpcCommunicator(a){this.stream=a,this.pending=[],this.stream.on("data",a=>{this.pending.shift().resolve(a)}),this.stream.on("error",a=>{this.pending.shift().reject(a)}),this.stream.on("status",a=>{this.pending.length&&this.pending.shift().reject(a)})}GrpcCommunicator.prototype.send=(()=>{var a=_asyncToGenerator(function*(a){var b=this;if(!this.stream.writable)throw"Transaction is already closed.";return new Promise(function(c,d){b.pending.push({resolve:c,reject:d}),b.stream.write(a)})});return function(){return a.apply(this,arguments)}})(),GrpcCommunicator.prototype.end=function(){return this.stream.end(),new Promise(a=>{this.stream.on("end",a)})},module.exports=GrpcCommunicator;